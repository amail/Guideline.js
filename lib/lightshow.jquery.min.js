/*LightShow v0.8
http://www.github.com/comfirm/LightShow.js/
https://raw.github.com/comfirm/LightShow.js/master/license.txt*/var LightShow=window.LightShow||{};LightShow.log=LightShow.log||function(e){};LightShow=function(e){this.options=$.extend(true,{},LightShow.default_options,e);this.initialize()};LightShow.initialize=function(){if(!LightShow.is_initialized){LightShow.is_initialized=true;LightShow.registerKeyCommands()}};LightShow.registerKeyCommands=function(){$(document).keydown(function(e){if(e.keyCode==27){var t=0;var n=null;$.each(LightShow.instances,function(e,r){if(r.isVisible()&&r.z_index_base>t){t=r.z_index_base;n=r}});if(n&&n.options.hideOnEscape){n.hide()}}})};LightShow.getRelativeElementPosition=function(e,t,n,r,i,s,o){var u=$.isWindow(e.get(0));var a=u?e.scrollLeft():e.position().left;var f=u?e.scrollTop():e.position().top;switch(n){case"left":break;case"center":a+=e.outerWidth()/2-t.outerWidth()/2;break;case"right":a+=e.outerWidth()-t.outerWidth();break}switch(r){case"top":break;case"middle":f+=e.outerHeight()/2-t.outerHeight()/2;break;case"bottom":f+=e.outerHeight()-t.outerHeight();break}return{top:f,left:a}};LightShow.elementHitTest=function(e,t){var n=e.position();if(t.x>=n.left&&t.x<n.left+e.width()){if(t.y>=n.top&&t.y<n.top+e.height()){return true}}return false};LightShow.waitUntilDimensioned=function(e,t,n){var r;r=function(e){var i=[];$(e).each(function(){if(!this.complete&&this.readyState!==4){if(!($(this).width()>0&&$(this).height()>0)){i.push(this)}}});if(i.length==0){t()}else{setTimeout(function(){r(i)},n)}};r(e)};LightShow.instances={};LightShow.is_initialized=false;LightShow.implicit_id_offset=0;LightShow.current_z_index=-1;LightShow.default_options={id:"null",overlay:"document",content:null,showOnStartup:false,showOnHover:false,hideButtonSelector:".hide-button",hideOnEscape:true,style:{opacity:.85,overflow:"hidden",background:null,backgroundColor:"#000"},position:{content:{x_directive:"center",y_directive:"middle"}},callback:{initialization:{before:function(){},after:function(){}},show:{before:function(){},after:function(){}},hide:{before:function(){},after:function(){}}},effect:{type:"fade",duration:500,show:null,hide:null}};LightShow.getHighestZIndex=function(e){var t=0;$(e).each(function(){var e=LightShow.getElementZIndex($(this));if(e>t){t=e}});return t};LightShow.getElementZIndex=function(e){return parseInt(e.css("zIndex"),10)};LightShow.getInternalId=function(e){return"ls-"+(e==null?"unnamed-"+ ++LightShow.implicit_id_offset:e)};LightShow.showAll=function(){$.each(LightShow.instances,function(e,t){t.show()})};LightShow.hideAll=function(){$.each(LightShow.instances,function(e,t){t.hide()})};LightShow.prototype.is_initialized=false;LightShow.prototype.is_visible=false;LightShow.prototype.resize_source=null;LightShow.prototype.overlay_element=null;LightShow.prototype.content_element=null;LightShow.prototype.z_index_base=-1;LightShow.prototype.effect_wait_for_load=false;LightShow.prototype.effect_deferred_callback=null;LightShow.prototype.reposition_timer_id=0;LightShow.prototype.initialize=function(){var e=this;if(!this.options.is_initialized){this.options.is_initialized=true;this.options.callback.initialization.before(this);if(!LightShow.is_initialized){LightShow.initialize()}if(this.options.overlay){this.effect_wait_for_load=true;LightShow.waitUntilDimensioned($("img, iframe",this.options.overlay),function(){e.effect_wait_for_load=false;e.effect_deferred_callback&&e.effect_deferred_callback();e.effect_deferred_callback=null},50,true)}this.setContent(this.options.content);this.initializeOverlay();this.setEffect(this.options.effect.type,this.options.effect.duration,true);this.readapt(true);if(this.options.overlay&&this.options.showOnHover){$(document).mousemove(function(t){if(LightShow.elementHitTest(e.options.overlay,{x:t.pageX,y:t.pageY})){e.show()}else{e.hide()}})}else if(this.options.showOnStartup){this.show()}this.options.callback.initialization.after(this)}};LightShow.prototype.initializeOverlay=function(){var e=this;if(!this.overlay_element){var t=this.createContainer();this.resize_source=e.isDocumentOverlay()?$(document):this.options.overlay;var n=e.isDocumentOverlay()?{top:0,left:0}:this.options.overlay.offset();t.attr("id",this.options.id+"-overlay").addClass("ls-overlay").css({top:n.top,left:n.left,background:this.options.style.background?this.options.style.background:this.options.style.backgroundColor,"background-color":this.options.style.backgroundColor,opacity:this.options.style.opacity});if(e.isDocumentOverlay()){t.click(function(){e.hide();return false})}this.overlay_element=t;t.appendTo($("body"))}};LightShow.prototype.createContainer=function(){return $("<div />").hide().css({position:"absolute",top:"0px",left:"0px",padding:"0px",margin:"0px",overflow:this.options.style.overflow})};LightShow.prototype.isVisible=function(){return this.is_visible};LightShow.prototype.isElementOverlay=function(){return this.options.overlay&&this.options.overlay!="document"};LightShow.prototype.moveToTop=function(){var e=LightShow;if(e.current_z_index==-1){e.current_z_index=e.getHighestZIndex("*")+1e3}this.z_index_base=!this.options.overlay&&this.isElementOverlay()?LightShow.getElementZIndex(this.options.overlay)+1:e.current_z_index+=100;this.overlay_element.css("z-index",this.z_index_base+5);this.content_element.css("z-index",this.z_index_base+10);return this};LightShow.prototype.show=function(e){var t=this;if(this.effect_wait_for_load){this.effect_deferred_callback=function(){t.readapt();t.show(e)};return}if(!this.is_visible){this.is_visible=true;t.options.callback.show.before(this);if(this.z_index_base==-1){this.moveToTop()}console.log(this.options);(this.options.effect.showOverlay||this.options.effect.show)(t.overlay_element,function(){});(this.options.effect.showContent||this.options.effect.show)(t.content_element,function(){e&&e();t.options.callback.show.after(t)})}return this};LightShow.prototype.hide=function(e){var t=this;if(this.effect_wait_for_load){this.effect_deferred_callback=function(){t.readapt();t.hide(e)};return}if(this.is_visible){this.is_visible=false;this.options.callback.hide.before(this);(this.options.effect.hideOverlay||this.options.effect.hide)(this.overlay_element,function(){});(this.options.effect.hideContent||this.options.effect.hide)(t.content_element,function(){e&&e();t.options.callback.hide.after(t)});this.options.callback.hide.after(this)}return this};LightShow.prototype.release=function(){this.overlay_element.remove();this.content_element.remove();this.overlay_element=this.content_element=null;delete LightShow.instances[this.options.id]};LightShow.prototype.isDocumentOverlay=function(){return this.options.overlay=="document"};LightShow.prototype.readapt=function(e){var t=this;var n=function(){if(!t.effect_wait_for_load){var e=t.isDocumentOverlay()?{top:0,left:0}:t.options.overlay.offset();t.overlay_element.css({top:e.top,left:e.left,width:t.resize_source.outerWidth(),height:t.resize_source.outerHeight()});var n=LightShow.getRelativeElementPosition(t.isDocumentOverlay()?$(window):t.options.overlay,t.content_element,t.options.position.content.x_directive,t.options.position.content.y_directive);if(t.reposition_timer_id){clearTimeout(t.reposition_timer_id);t.reposition_timer_id=setTimeout(function(){t.content_element.animate(n,400);reposition_timer_id=0},50)}else{t.reposition_timer_id=1;t.content_element.css(n)}}};if(e){$(window).resize(n).ready(n).load(n).scroll(n);$("img, iframe, script",t.options.overlay).load(n).each(function(){if(this.complete){$(this).trigger("load")}});this.resize_source.resize(n)}n();return this};LightShow.prototype.setEffect=function(e,t,n){var r,i=null;t=t||this.options.effect.duration;switch(e){case"fade":r=function(e,n){e.fadeIn(t,n)};i=function(e,n){e.fadeOut(t,n)};break;case"slide":r=function(e,n){e.slideDown(t,n)};i=function(e,n){e.slideUp(t,n)};break;case"toggle":r=function(e,n){e.show(t,n)};i=function(e,n){e.hide(t,n)};break;default:LightShow.log("Invalid effect type '"+e+"'. Effect does not exist.");break}if(r&&i){if(!(n&&this.options.effect.show)){this.options.effect.show=r}if(!(n&&this.options.effect.hide)){this.options.effect.hide=i}}return this};LightShow.prototype.setContent=function(e){var t=this;if(this.content_element){this.content_element.remove();this.content_element=null}var n=(typeof e).toLowerCase()=="string"?$(e):e instanceof jQuery?e:null;if(n){var r=this.createContainer().addClass("ls-content").append(n);if($(this.options.hideButtonSelector,r).length>0){$(this.options.hideButtonSelector,r).click(function(){t.hide();return false})}this.content_element=r;$("body").append(r)}else{LightShow.log("Unable to set content. Content neither JQuery element or string (HTML).")}return this};var JQuery=JQuery||$||{};jQuery.lightShow=function(e){var t;var n=LightShow;if((typeof e).toLowerCase()=="string"){var r=n.getInternalId(e);if(r in n.instances){t=n.instances[r]}else{LightShow.log("Invalid ID '"+r+"'. LightShadow instance not found.")}}else{var r=e.id=n.getInternalId(e.id);if(r in n.instances){LightShow.log("LightShadow instance ID '"+r+"' already used. Please select another one")}else{t=n.instances[r]=new n(e)}}return t};